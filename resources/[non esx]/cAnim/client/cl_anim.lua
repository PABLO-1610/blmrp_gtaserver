if GetCurrentResourceName()~="cAnim"then return end;local function a()local b={}for c,d in ipairs(GetActivePlayers())do if DoesEntityExist(GetPlayerPed(d))then table.insert(b,d)end end;return b end;ShowNotification=function(e)SetNotificationTextEntry('STRING')AddTextComponentSubstringPlayerName(e)DrawNotification(false,true)end;ShowHelpMessage=function(e)SetTextComponentFormat("STRING1")AddLongString(e)DisplayHelpTextFromStringLabel(0,0,0,-1)end;local f=true;local function g(h)for i,j in pairs(a())do local k=GetPlayerPed(j)if k~=PlayerPedId()and GetDistanceBetweenCoords(GetEntityCoords(k),GetEntityCoords(PlayerPedId()))<=h and IsEntityVisible(k)then return j end end;return false end;local l,m,n={},{},{}local o=false;local function p()if#m>0 then for c,j in pairs(m)do DeleteEntity(j)end end end;local function q(r,s,t,u,v,w,x,y)local z=GetHashKey(r)while not HasModelLoaded(z)do RequestModel(z)Wait(10)end;prop=CreateObject(z,GetEntityCoords(PlayerPedId()),true,true,true)SetEntityAsMissionEntity(prop,true,false)AttachEntityToEntity(prop,PlayerPedId(),GetPedBoneIndex(PlayerPedId(),s),t,u,v,w,x,y,true,true,false,true,1,true)table.insert(m,prop)SetModelAsNoLongerNeeded(z)end;local function A()o=false;p()end;local function B(C,D,E,F,G,H,I,J,K,L,M,N)o=true;while o do Wait(5)if IsControlPressed(0,47)then while not HasNamedPtfxAssetLoaded(E)do RequestNamedPtfxAsset(E)Wait(10)end;UseParticleFxAssetNextCall(E)local O=StartNetworkedParticleFxLoopedOnEntityBone(F,G and PlayerPedId()or prop,H,I,J,K,L,M,GetEntityBoneIndexByName(F,"VFX"),1065353216,0,0,0,1065353216,1065353216,1065353216,0)SetParticleFxLoopedColour(O,1.0,1.0,1.0)table.insert(n,O)Wait(C)for P,Q in pairs(n)do StopParticleFxLooped(Q,false)table.remove(n,P)end else ShowHelpMessage(D)end end end;local function R(Infos)if Infos~=false then local S,T=0,-1;local U,V,W=table.unpack(Infos)A()if U=="Expression"then SetFacialIdleAnimOverride(PlayerPedId(),V,0)if V=="default"then ClearFacialIdleAnimOverride(PlayerPedId())end;return end;if(U=="MaleScenario"or"Scenario")and not IsPedInAnyVehicle(PlayerPedId(),false)then if U=="MaleScenario"then if GetEntityModel(PlayerPedId())==GetHashKey("mp_m_freemode_01")then TaskPlayAnimToPlayer(V,nil,0)else ShowNotification("~r~Cet emote est réservé aux hommes.")end;return elseif U=="ScenarioObject"then TaskStartScenarioAtPosition(PlayerPedId(),V,GetOffsetFromEntityInWorldCoords(PlayerPedId(),0.0,0-0.5,-0.5),GetEntityHeading(PlayerPedId()),0,1,false)return elseif U=="Scenario"then TaskPlayAnimToPlayer(V,nil,0)return end end;while not HasAnimDictLoaded(U)do RequestAnimDict(U)Wait(10)end;if Infos.AnimationOptions then if IsPedInAnyVehicle(PlayerPedId(),false)then S=51 elseif Infos.AnimationOptions.EmoteMoving then S=51 elseif Infos.AnimationOptions.EmoteLoop then S=1 elseif Infos.AnimationOptions.EmoteStuck then S=50 end;if Infos.AnimationOptions.EmoteDuration~=nil then T=Infos.AnimationOptions.EmoteDuration end end;local X={U,V}TaskPlayAnimToPlayer(X,nil,S)RemoveAnimDict(U)if Infos.AnimationOptions then if Infos.AnimationOptions.Prop then Wait(T)q(Infos.AnimationOptions.Prop,Infos.AnimationOptions.PropBone,table.unpack(Infos.AnimationOptions.PropPlacement))if Infos.AnimationOptions.SecondProp then q(Infos.AnimationOptions.SecondProp,Infos.AnimationOptions.SecondPropBone,table.unpack(Infos.AnimationOptions.SecondPropPlacement))end end;if Infos.AnimationOptions.PtfxAsset then Wait(1000)B(Infos.AnimationOptions.PtfxWait,Infos.AnimationOptions.PtfxInfo,Infos.AnimationOptions.PtfxAsset,Infos.AnimationOptions.PtfxName,Infos.AnimationOptions.PtfxNoProp,table.unpack(Infos.AnimationOptions.PtfxPlacement))end end end end;local function Y(Infos)RequestAnimSet(Infos[1])while not HasAnimSetLoaded(Infos[1])do Citizen.Wait(1)end;SetPedMovementClipset(PlayerPedId(),Infos[1],0.2)RemoveAnimSet(Infos[1])if Infos[1]=="move_f@multiplayer"or Infos[1]=="move_m@multiplayer"then ResetPedMovementClipset(PlayerPedId(),0)end end;local function Z(Infos,_)local k=g(3)if k then TriggerServerEvent("cAnim:RequestEmote",GetPlayerServerId(k),_,Infos[3])else ShowNotification("~b~Distance\n~w~Rapprochez-vous.")end end;RegisterNetEvent("ClientEmoteRequestReceive")AddEventHandler("ClientEmoteRequestReceive",function(a0,a1)PlaySound(-1,"NAV","HUD_AMMO_SHOP_SOUNDSET",0,0,1)ShowNotification("~y~Y~w~ accepter, ~r~L~w~ refuser (~g~"..a1 .."~w~)")local a2=1;while a2<=100 do Citizen.Wait(5)a2=a2+1;if IsControlJustPressed(1,246)then TriggerServerEvent("cAnim:ValidServer",GetPlayerServerId(g(3)),a0)elseif IsControlJustPressed(1,182)then ShowNotification("~r~Emote refusée.")end end end)RegisterNetEvent("cAnimTaskAnimPlayer")AddEventHandler("cAnimTaskAnimPlayer",function(a3,a4)local a5=GetPlayerPed(g(3))local a6=GetOffsetFromEntityInWorldCoords(a5,0.0,1.0,0.0)if AnimList.Partage[a3].AnimationOptions.SyncOffsetFront then a6=GetOffsetFromEntityInWorldCoords(a5,0.0,AnimList.Partage[a3].AnimationOptions.SyncOffsetFront,0.0)end;SetEntityHeading(PlayerPedId(),GetEntityHeading(a5)-180.1)SetEntityCoordsNoOffset(PlayerPedId(),a6.x,a6.y,a6.z,0)R(AnimList.Partage[a3])end)local function a7(a8,Infos)if not Infos then DeleteResourceKvp(string.format('animBind%s',a8))else SetResourceKvp(string.format('animBind%s',a8),tostring(Infos.Dict)..","..tostring(Infos.ListId))end;local a9={}local aa=GetResourceKvpString(string.format('animBind%s',a8))if aa~=nil then for ab in aa:gmatch('([^,]+)')do table.insert(a9,ab)end;if a9[1]and a9[2]then l[a8]={Assign=true,Anim=AnimList[a9[1]][a9[2]]}else l[a8]={Assign=false,Anim=false}end else l[a8]={Assign=false,Anim=false}end end;RegisterNetEvent('cAnim:CanAnimBind')AddEventHandler('cAnim:CanAnimBind',function(ac)f=ac end)local function ad()for ae=1,9 do local a9={}local aa=GetResourceKvpString(string.format('animBind%s',ae))if aa~=nil then for ab in aa:gmatch('([^,]+)')do table.insert(a9,ab)end;if a9[1]and a9[2]then a7(ae,{Dict=a9[1],ListId=a9[2]})else a7(ae,false)end else a7(ae,false)end;RegisterKeyMapping(string.format('animBind%s',ae),string.format("Jouer l'animation n°%s",ae),"keyboard",string.format("NUMPAD%s",ae))RegisterCommand(string.format('animBind%s',ae),function()if l[ae].Assign then if l[ae].Anim.Dict=="Demarches"then Y(l[ae].Anim)else local af=l[ae].Anim;local S,T=0,-1;local U,V,W=table.unpack(af)if not f then return end;if U=="Expression"then SetFacialIdleAnimOverride(PlayerPedId(),V,0)return end;if(U=="MaleScenario"or"Scenario")and not IsPedInAnyVehicle(PlayerPedId(),false)then if U=="MaleScenario"then if GetEntityModel(PlayerPedId())==GetHashKey("mp_m_freemode_01")then TaskPlayAnimToPlayer(V,nil,0)else ShowNotification("~r~Cet emote est réservé aux hommes.")end;return elseif U=="ScenarioObject"then TaskStartScenarioAtPosition(PlayerPedId(),V,GetOffsetFromEntityInWorldCoords(PlayerPedId(),0.0,0-0.5,-0.5),GetEntityHeading(PlayerPedId()),0,1,false)return elseif U=="Scenario"then TaskPlayAnimToPlayer(V,nil,0)return end end;if af.AnimationOptions then if IsPedInAnyVehicle(PlayerPedId(),false)then S=51 elseif af.AnimationOptions.EmoteMoving then S=51 elseif af.AnimationOptions.EmoteLoop then S=1 elseif af.AnimationOptions.EmoteStuck then S=50 end;if af.AnimationOptions.EmoteDuration~=nil then T=af.AnimationOptions.EmoteDuration end end;local X={U,V}TaskPlayAnimToPlayer(X,nil,S)end end end)end end;local function ag()local ah=RMenu.Add('anim','main',RageUI.CreateMenu("Animations","Animations"),true)local ai=RMenu.Add('anim',"submenu",RageUI.CreateSubMenu(ah,"Animations","Animations"),true)local aj=RMenu.Add('anim',"submenu2",RageUI.CreateSubMenu(ai,"Animations","Animations"),true)local ak=RMenu.Add('anim',"submenu3",RageUI.CreateSubMenu(aj,"Animations","Animations"),true)local al={{name="Jouer l'animation",submenu=false},{name="Annuler l'animation",submenu=false},{name="Bind l'animation",submenu=ak},{name="Supprimer l'animation des binds",submenu=ak}}RageUI.Visible(ah,not RageUI.Visible(ah))while ah~=nil do RageUI.IsVisible(ah,function()RageUI.Item.Button("Annuler l'animation","Annuler l'animation",{RightBadge=nil},true,{onSelected=function()ClearPedTasks(GetPlayerPed(-1))o=false;p()end})for am,an in pairs(AnimList)do RageUI.Item.Button(am,am,{RightLabel="→"},true,{onSelected=function()Infos={Dict=am}end},ai)end end)RageUI.IsVisible(ai,function()if Infos~=nil then for ao,ap in pairs(AnimList[Infos.Dict])do RageUI.Item.Button((Infos.Dict=="Expressions"or Infos.Dict=="Demarches")and ao or ap[3],ao,{RightLabel="→"},true,{onSelected=function()Infos={Dict=Infos.Dict,ListId=ao,infos=AnimList[Infos.Dict][ao]}end},aj)end end end)RageUI.IsVisible(aj,function()for aq,ar in pairs(al)do RageUI.Item.Button(ar.name,ar.name,{RightLabel="→"},true,{onSelected=function()if ar.name=="Annuler l'animation"then ClearPedTasks(GetPlayerPed(-1))o=false;p()if Infos.Dict=="Demarches"then ResetPedMovementClipset(PlayerPedId(),0)TriggerEvent("demarche:upstar",false,false,"rien")elseif Infos.Dict=="Expression"then ClearFacialIdleAnimOverride(PlayerPedId())TriggerEvent("demarche:upstar",false,false,false,"rien")end elseif ar.name=="Jouer l'animation"then if Infos.Dict=="Demarches"then Y(Infos.infos)elseif Infos.Dict=="Partage"then Z(Infos.infos,Infos.ListId)else R(Infos.infos)end else Infos={NameMenu=ar.name,Dict=Infos.Dict,ListId=Infos.ListId,infos=Infos.infos}end end},ar.submenu)end end)RageUI.IsVisible(ak,function()for a8,ar in ipairs(l)do if Infos.NameMenu=="Bind l'animation"and not ar.Assign then RageUI.Item.Button("Touches n°"..a8,"Assigner l'animation à cette touche",{RightLabel="→"},true,{onSelected=function()RageUI.GoBack()ShowNotification("Vous avez bind l'animations: ~b~"..Infos.ListId.."~s~ sur la touche: ~b~"..a8 .."~s~.")a7(a8,{Dict=Infos.Dict,ListId=Infos.ListId})end})elseif Infos.NameMenu=="Supprimer l'animation des binds"and ar.Assign then RageUI.Item.Button("Touches n°"..a8,"Supprimer l'animation à cette touche",{RightLabel="→"},true,{onSelected=function()ShowNotification("~r~Vous avez supprimé une animations sur la tocuhe: ~b~"..a8 .."~s~.")a7(a8,false)end})end end end)if not RageUI.Visible(ah)and not RageUI.Visible(ai)and not RageUI.Visible(aj)and not RageUI.Visible(ak)then ah=RMenu:DeleteType('anim',true)end;Citizen.Wait(5)end end;RegisterKeyMapping("animmenu","Ouvrir le menu des animations (Bind)","keyboard","F2")RegisterCommand("animmenu",function()ag()end)ad()